import{_ as K,E as N}from"./DPSFwcM6.js";import{_ as L,r as i,o as u,c,a as e,p as V,v as $,u as s,s as I,x as z,q as w,m as h,t as P,F as A,y as B,B as D,n as q,d as R,b as M,w as T,z as U}from"./DbyeV-U8.js";const j={class:"input-container"},F={class:"input-wrapper"},O={__name:"SparePartInput",emits:["submitPartIds"],setup(g,{emit:f}){const d=f,a=i(""),t=()=>{a.value.trim()&&d("submitPartIds",a.value.split(",").map(m=>m.trim()))},l=()=>{a.value=""};return(m,o)=>(u(),c("div",j,[o[1]||(o[1]=e("span",{class:"baslik"},"Ürünleri plakaya isle: ",-1)),e("div",F,[V(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=b=>I(a)?a.value=b:null),onKeyup:z(t,["enter"]),placeholder:"Ürün numarasi ekle (virgülle ayir)",class:"styled-input"},null,544),[[$,s(a)]]),s(a)?(u(),c("span",{key:0,class:"clear-button",onClick:l},"X")):w("",!0)]),e("button",{onClick:t,class:"styled-button"},"Ürünleri isle")]))}},Q=L(O,[["__scopeId","data-v-58bca01d"]]),G=["onClick"],X={class:"buttons"},H={__name:"CarsSearch",props:{cars:{type:Array,required:!0}},emits:["selectCar"],setup(g,{emit:f}){const d=f,a=g,t=i(""),l=i(null),m=i(10),o=i(1),b=k=>{l.value=k,d("selectCar",k.arac_id)},n=h(()=>a.cars.filter(k=>k.arac_id.toLowerCase().includes(t.value.toLowerCase()))),r=h(()=>{const x=o.value*m.value;return n.value.slice(0,x)}),p=h(()=>o.value*m.value<n.value.length),v=h(()=>o.value!==1),_=()=>{o.value++},y=()=>{o.value--},C=()=>{t.value.trim()||(t.value=""),o.value=1};return(k,x)=>(u(),c("div",null,[V(e("input",{"onUpdate:modelValue":x[0]||(x[0]=S=>I(t)?t.value=S:null),placeholder:"Arac plakasi ara",onKeyup:z(C,["enter"]),class:"search-input"},null,544),[[$,s(t)]]),e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"Kayitli arac listesi. ("+P(g.cars.length)+" kayitli arac blunmaktadir): ",1)])]),e("tbody",null,[(u(!0),c(A,null,B(s(r),(S,E)=>(u(),c("tr",{key:E,onClick:ae=>b(S),class:D({"selected-car":s(l)&&s(l).arac_id===S.arac_id})},[e("td",null,P(S.arac_id),1)],10,G))),128))])]),e("div",X,[e("div",null,[s(p)?(u(),c("button",{key:0,onClick:_,class:"load-more-btn"}," Daha fazla arac göster ")):w("",!0),s(v)?(u(),c("button",{key:1,onClick:y,class:"load-less-btn"}," Daha az arac göster ")):w("",!0)])])]))}},J=L(H,[["__scopeId","data-v-a486e5c8"]]),W={class:"buttons"},Y={__name:"SpareParts",props:{parts:{type:Array,required:!0}},emits:["selectPart"],setup(g,{emit:f}){const d=g,a=i(""),t=i(10),l=i(1),m=h(()=>d.parts.filter(_=>_.ürün_numarasi.toString().includes(a.value.toLowerCase())||_.ürün_ismi.toLowerCase().includes(a.value.toLowerCase()))),o=h(()=>{const y=l.value*t.value;return m.value.slice(0,y)}),b=h(()=>l.value*t.value<m.value.length),n=h(()=>l.value!==1),r=()=>{l.value++},p=()=>{l.value--},v=()=>{a.value.trim()||(a.value=""),l.value=1};return(_,y)=>(u(),c("div",null,[V(e("input",{"onUpdate:modelValue":y[0]||(y[0]=C=>I(a)?a.value=C:null),placeholder:"Parça ara - numara veya isim ara",onKeyup:z(v,["enter"]),class:"search-input"},null,544),[[$,s(a)]]),e("table",null,[y[1]||(y[1]=e("thead",null,[e("tr",null,[e("th",null,"Ürün numarasi"),e("th",null,"Ürün adi"),e("th",null,"Stok adedi")])],-1)),e("tbody",null,[(u(!0),c(A,null,B(s(o),(C,k)=>(u(),c("tr",{key:k},[e("td",null,P(C.ürün_numarasi),1),e("td",null,P(C.ürün_ismi),1),e("td",null,P(C.ürün_adedi),1)]))),128))])]),e("div",W,[e("div",null,[s(b)?(u(),c("button",{key:0,onClick:r,class:"load-more-btn"}," Daha fazla parça göster ")):w("",!0),s(n)?(u(),c("button",{key:1,onClick:p,class:"load-less-btn"}," Daha az parça göster ")):w("",!0)])])]))}},Z=L(Y,[["__scopeId","data-v-971737e6"]]),ee={__name:"index",setup(g){const f=i([]),d=i([]),a=i(null),t=i(!1),l=i(""),m=n=>{a.value=n};q(async()=>{try{const n=await fetch("/api/cars"),r=await fetch("/api/parts");n.ok&&(f.value=await n.json()),r.ok&&(d.value=await r.json(),d.value.sort((p,v)=>p.ürün_numarasi-v.ürün_numarasi))}catch(n){console.error("Verlier yüklenemedi.:",n),t.value=!0,l.value="Verlier yüklenemedi."}});const o=async n=>{if(console.log("partsId: ",n),!a.value){t.value=!0,l.value="Arac (Plaka) secilme. Lütfe bir arac secin";return}if(!n.length||n.some(r=>!r)){t.value=!0,l.value="Ürün numarasi bulunamadi. Gecerli ürün numarasi ekleyin.";return}console.log("partIds: ",n);for(let r=0;r<n.length;r++){const p=n[r],v=d.value.find(_=>_.ürün_numarasi===p);if(v&&v.adet>0){if(v.adet-=1,v.adet<0){t.value=!0,l.value=`${p} yeterli stogu bulunmamaktadir.`;break}}else{t.value=!0,l.value=`${p} numarasinda bir ürün bulunamadi.`;break}}if(!t.value)try{await $fetch("/api/parts",{method:"POST",body:d.value})}catch{showErrorModal("Ürünler sisteme eklenemedi.")}},b=()=>{t.value=!1};return(n,r)=>{const p=K;return u(),c("div",null,[r[1]||(r[1]=e("h2",null,"Araclar",-1)),e("h3",null,[r[0]||(r[0]=R("Bir arac seciniz (Plaka): ")),e("span",{class:D({"car-selected":s(a),"car-not-selected":!s(a)})},P(s(a)?s(a):"Arac Secilmedi"),3)]),M(Q,{onSubmitPartIds:o}),M(p,null,{default:T(()=>[s(t)?(u(),U(N,{key:0,showModal:s(t),errorMessage:s(l),onClose:b},null,8,["showModal","errorMessage"])):w("",!0)]),_:1}),r[2]||(r[2]=e("h3",null,"Arac Plakasi sec",-1)),M(J,{cars:s(f),onSelectCar:m},null,8,["cars"]),r[3]||(r[3]=e("h3",null,"Ürün listesi: ",-1)),M(Z,{parts:s(d)},null,8,["parts"])])}}},se=L(ee,[["__scopeId","data-v-3504925e"]]);export{se as default};
